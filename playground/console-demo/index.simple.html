<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>远程控制台演示 - XAgi Monitor</title>

    <!-- 使用 CDN 加载 React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel 转换器 -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #1a1a1a;
      }

      .console-demo-container {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        margin: 2rem auto;
        max-width: 1200px;
        color: #1a1a1a;
      }

      .demo-header {
        margin-bottom: 2rem;
        text-align: center;
      }

      .demo-header h1 {
        color: #10b981;
        font-size: 2rem;
        margin-bottom: 0.5rem;
      }

      .demo-header p {
        color: #6b7280;
        font-size: 1.1rem;
      }

      .connection-status {
        background: #f0fdf4;
        border: 1px solid #bbf7d0;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 2rem;
        color: #166534;
      }

      .connection-status.disconnected {
        background: #fef2f2;
        border-color: #fecaca;
        color: #dc2626;
      }

      .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #22c55e;
        animation: pulse 2s infinite;
        display: inline-block;
        margin-right: 0.5rem;
      }

      .status-indicator.disconnected {
        background: #ef4444;
        animation: none;
      }

      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
      }

      .console-categories {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-top: 2rem;
      }

      .console-category {
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 1.5rem;
      }

      .console-category h3 {
        color: #374151;
        margin-bottom: 1rem;
      }

      .console-category .description {
        color: #6b7280;
        font-size: 0.9rem;
        margin-bottom: 1rem;
      }

      .console-buttons {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .console-btn {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        border: none;
        padding: 0.75rem 1rem;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.3s ease;
      }

      .console-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.3);
      }

      .console-btn.warn {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      }

      .console-btn.error {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      }

      .demo-instructions {
        background: #eff6ff;
        border: 1px solid #bfdbfe;
        border-radius: 8px;
        padding: 1rem;
        margin-top: 2rem;
        color: #1e40af;
      }

      .demo-instructions h4 {
        margin-top: 0;
        color: #1e40af;
      }

      .demo-instructions ul {
        margin: 0;
        padding-left: 1.5rem;
      }

      .demo-instructions li {
        margin-bottom: 0.5rem;
      }

      .server-url {
        background: #1e293b;
        color: #22d3ee;
        padding: 0.5rem;
        border-radius: 6px;
        font-family: 'Courier New', monospace;
        font-weight: bold;
        display: inline-block;
        margin: 0.5rem 0;
      }

      .log-count {
        font-weight: bold;
        color: #10b981;
      }

      @media (max-width: 768px) {
        .console-demo-container {
          margin: 1rem;
          padding: 1rem;
        }

        .console-categories {
          grid-template-columns: 1fr;
          gap: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      function App() {
        const [connectionStatus, setConnectionStatus] = useState('disconnected');
        const [logCount, setLogCount] = useState(0);

        useEffect(() => {
          // 模拟连接状态检测
          const checkConnection = () => {
            const isConnected = window.__XAGI_CONSOLE_CONNECTED__ || false;
            setConnectionStatus(isConnected ? 'connected' : 'disconnected');
          };

          const interval = setInterval(checkConnection, 1000);
          return () => clearInterval(interval);
        }, []);

        // 基础日志测试
        const testBasicLogs = () => {
          console.log('📝 这是一个基础日志');
          console.info('ℹ️ 这是一个信息日志');
          console.warn('⚠️ 这是一个警告日志');
          console.error('❌ 这是一个错误日志');
          console.debug('🐛 这是一个调试日志');

          console.table([
            { name: '张三', age: 25, city: '北京' },
            { name: '李四', age: 30, city: '上海' }
          ]);
          setLogCount(prev => prev + 6);
        };

        // 对象日志测试
        const testObjectLogs = () => {
          const user = {
            id: 1,
            name: '张三',
            email: 'zhangsan@example.com',
            profile: {
              age: 25,
              city: '北京',
              hobbies: ['编程', '阅读', '运动']
            }
          };

          console.log('用户信息:', user);
          console.table(user.profile);
          setLogCount(prev => prev + 2);
        };

        // 数组日志测试
        const testArrayLogs = () => {
          const products = [
            { id: 1, name: '笔记本电脑', price: 5999, category: '电子产品' },
            { id: 2, name: '无线鼠标', price: 99, category: '配件' },
            { id: 3, name: '机械键盘', price: 299, category: '配件' }
          ];

          console.log('产品列表:', products);
          console.table(products);
          setLogCount(prev => prev + 2);
        };

        // 性能日志测试
        const testPerformanceLogs = () => {
          console.time('性能测试');
          let sum = 0;
          for (let i = 0; i < 100000; i++) {
            sum += Math.random();
          }
          console.timeEnd('性能测试');
          console.log('计算结果:', sum);
          setLogCount(prev => prev + 2);
        };

        // 网络请求日志
        const testNetworkLogs = async () => {
          console.log('🌐 开始网络请求测试');

          try {
            console.log('发送 GET 请求...');
            const response = await fetch('https://jsonplaceholder.typicode.com/posts/1');
            const data = await response.json();
            console.log('请求成功:', data);
          } catch (error) {
            console.error('请求失败:', error);
          }

          setLogCount(prev => prev + 3);
        };

        // 错误和异常日志
        const testErrorLogs = () => {
          try {
            // 故意触发错误
            JSON.parse('{"invalid": json}');
          } catch (error) {
            console.error('JSON 解析错误:', error);
          }

          // 创建自定义错误
          const customError = new Error('这是一个自定义错误');
          customError.stack = '自定义错误堆栈信息';
          console.error('自定义错误:', customError);

          setLogCount(prev => prev + 2);
        };

        // 实时数据流日志
        const testRealTimeLogs = () => {
          let count = 0;
          const interval = setInterval(() => {
            count++;
            console.log(`📊 实时数据 #${count}/10:`, {
              timestamp: new Date().toISOString(),
              value: Math.random() * 100,
              status: count % 2 === 0 ? 'active' : 'idle'
            });

            if (count >= 10) {
              clearInterval(interval);
              console.log('🏁 实时数据流结束');
            }
          }, 500);

          setLogCount(prev => prev + 11);
        };

        // 批量日志压力测试
        const testBatchLogs = () => {
          console.log('🚀 开始批量日志压力测试...');

          const startTime = Date.now();
          for (let i = 0; i < 100; i++) {  // 减少到100条避免浏览器卡顿
            console.log(`批量日志 ${i + 1}/100:`, {
              id: i,
              data: Math.random().toString(36),
              timestamp: Date.now()
            });
          }

          const endTime = Date.now();
          console.log(`✅ 批量日志完成，耗时: ${endTime - startTime}ms`);
          setLogCount(prev => prev + 101);
        };

        return (
          <div className="console-demo-container">
            <div className="demo-header">
              <h1>📡 远程控制台演示</h1>
              <p>实时监控和转发浏览器控制台日志到远程服务器</p>
            </div>

            <div className={`connection-status ${connectionStatus === 'disconnected' ? 'disconnected' : ''}`}>
              <h3>
                <span className={`status-indicator ${connectionStatus === 'disconnected' ? 'disconnected' : ''}`}></span>
                WebSocket 连接状态: {connectionStatus === 'connected' ? '已连接' : '未连接'}
              </h3>
              <p>
                {connectionStatus === 'connected'
                  ? '正在实时转发控制台日志到远程服务器'
                  : '请等待 WebSocket 连接建立...'}
              </p>
              {connectionStatus === 'connected' && (
                <p><strong>已发送日志数量:</strong> <span className="log-count">{logCount}</span></p>
              )}
            </div>

            <div className="console-categories">
              <div className="console-category">
                <h3>📝 基础日志测试</h3>
                <p className="description">测试不同级别的控制台输出</p>
                <div className="console-buttons">
                  <button className="console-btn" onClick={testBasicLogs}>
                    基础日志 (log/info/warn/error/debug)
                  </button>
                  <button className="console-btn" onClick={testObjectLogs}>
                    对象日志 (Object)
                  </button>
                  <button className="console-btn" onClick={testArrayLogs}>
                    数组日志 (Array/Table)
                  </button>
                </div>
              </div>

              <div className="console-category">
                <h3>⚡ 性能和调试</h3>
                <p className="description">性能监控和调试相关日志</p>
                <div className="console-buttons">
                  <button className="console-btn" onClick={testPerformanceLogs}>
                    性能测试 (time/timeEnd)
                  </button>
                  <button className="console-btn warn" onClick={testErrorLogs}>
                    错误日志 (try/catch)
                  </button>
                  <button className="console-btn" onClick={testNetworkLogs}>
                    网络请求日志
                  </button>
                </div>
              </div>

              <div className="console-category">
                <h3>🔄 实时和批量</h3>
                <p className="description">实时数据流和大量日志测试</p>
                <div className="console-buttons">
                  <button className="console-btn" onClick={testRealTimeLogs}>
                    实时数据流 (定时器)
                  </button>
                  <button className="console-btn error" onClick={testBatchLogs}>
                    批量压力测试 (100条)
                  </button>
                </div>
              </div>
            </div>

            <div className="demo-instructions">
              <h4>🎯 演示功能说明</h4>
              <ul>
                <li><strong>启动开发服务器</strong>: 运行 <code>pnpm dev</code></li>
                <li><strong>打开远程控制台</strong>: 在另一个终端中访问 WebSocket 服务器</li>
                <li><strong>连接地址</strong>: <div className="server-url">ws://localhost:3001</div></li>
                <li><strong>测试日志</strong>: 点击上方按钮生成各种类型的日志</li>
                <li><strong>观察转发</strong>: 在远程控制台查看实时转发的日志</li>
              </ul>
              <p><strong>特性</strong>: 实时转发、日志持久化、多客户端连接、日志过滤、历史记录</p>
            </div>
          </div>
        );
      }

      ReactDOM.render(<App />, document.getElementById('root'));
    </script>
  </body>
</html>